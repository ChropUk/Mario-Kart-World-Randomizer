<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mario Kart World Randomizer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #FF6B6B, #4ECDC4, #45B7D1, #96CEB4);
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite;
            min-height: 100vh;
            color: #333;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }

        .header {
            margin-bottom: 40px;
        }

        .title {
            font-size: 3.5rem;
            font-weight: bold;
            color: #fff;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .subtitle {
            font-size: 1.8rem;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }

        .description {
            font-size: 1.2rem;
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            margin-bottom: 30px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .loading-message {
            background: rgba(255,255,255,0.9);
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.3);
            font-size: 1.1rem;
            color: #333;
        }

        .generate-btn {
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.5rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            margin-bottom: 40px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .generate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(0,0,0,0.4);
        }

        .generate-btn:active {
            transform: translateY(-1px);
        }

        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .players-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            align-items: center;
        }

        .player {
            background: rgba(255,255,255,0.9);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.3);
            max-width: 500px;
            width: 100%;
        }

        .player-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }

        .combination {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .slot-container {
            width: 120px;
            height: 120px;
            border: 3px solid #ddd;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            background: #f9f9f9;
        }

        .slot {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        .slot-item {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            transition: transform 0.1s ease;
        }

        .slot-image {
            width: 80%;
            height: 80%;
            object-fit: contain;
            margin-bottom: 5px;
        }

        .slot-text {
            font-size: 0.7rem;
            font-weight: bold;
            color: #333;
            text-align: center;
            line-height: 1;
        }

        .slot.spinning .slot-item {
            animation: spin 0.1s linear infinite;
        }

        @keyframes spin {
            0% { transform: translateY(0); }
            100% { transform: translateY(-100%); }
        }

        .plus-icon {
            font-size: 2rem;
            color: #666;
            font-weight: bold;
        }

        .add-player-btn {
            background: linear-gradient(45deg, #4ECDC4, #44A08D);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .add-player-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .add-player-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        @media (max-width: 768px) {
            .title {
                font-size: 2.5rem;
            }
            
            .subtitle {
                font-size: 1.4rem;
            }
            
            .description {
                font-size: 1rem;
            }
            
            .combination {
                flex-direction: column;
                gap: 15px;
            }
            
            .plus-icon {
                transform: rotate(90deg);
            }
            
            .slot-container {
                width: 100px;
                height: 100px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">Mario Kart World Randomizer</h1>
            <h2 class="subtitle">Random Character</h2>
            <p class="description">Click "Generate" to create a random combination of character + kart. Click the + button to create more players.</p>
        </div>

        <div class="loading-message" id="loadingMessage">
            Loading characters and karts from folders...
        </div>

        <button class="generate-btn" onclick="generateAll()" id="generateBtn" disabled>Loading...</button>

        <div class="players-container" id="playersContainer">
            <div class="player">
                <div class="player-title">Player 1</div>
                <div class="combination">
                    <div class="slot-container">
                        <div class="slot" id="character-slot-0">
                            <div class="slot-item">
                                <img src="" alt="Start" class="slot-image" style="display:none">
                                <div class="slot-text">Loading...</div>
                            </div>
                        </div>
                    </div>
                    <div class="plus-icon">+</div>
                    <div class="slot-container">
                        <div class="slot" id="kart-slot-0">
                            <div class="slot-item">
                                <img src="" alt="Start" class="slot-image" style="display:none">
                                <div class="slot-text">Loading...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <button class="add-player-btn" onclick="addPlayer()" id="addPlayerBtn" disabled>+ Add Player</button>
    </div>

    <script>
        let characters = [];
        let karts = [];
        let players = 1;
        let isGenerating = false;
        let assetsLoaded = false;

        // Function to format filename to display name
        function formatName(filename) {
            // Remove file extension
            const nameWithoutExt = filename.replace(/\.[^/.]+$/, "");
            // Add space before capital letters (except the first one)
            return nameWithoutExt.replace(/([A-Z])/g, ' $1').trim();
        }

        // Function to scan a directory for image files
        async function scanDirectory(path) {
            try {
                const response = await fetch(path);
                if (!response.ok) {
                    throw new Error(`Directory not found: ${path}`);
                }
                
                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const links = Array.from(doc.querySelectorAll('a[href]'));
                
                const imageFiles = links
                    .map(link => link.getAttribute('href'))
                    .filter(href => /\.(png|jpg|jpeg|gif|webp)$/i.test(href))
                    .filter(href => !href.startsWith('.') && !href.startsWith('/'));
                
                return imageFiles.map(filename => ({
                    picture: `${path}/${filename}`,
                    name: formatName(filename)
                }));
            } catch (error) {
                console.warn(`Could not scan directory ${path}:`, error);
                return [];
            }
        }

        // Function to recursively scan directories for characters
        async function scanCharacterDirectories(basePath = '/Characters') {
            try {
                const response = await fetch(basePath);
                if (!response.ok) {
                    throw new Error(`Directory not found: ${basePath}`);
                }
                
                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const links = Array.from(doc.querySelectorAll('a[href]'));
                
                // Get subdirectories
                const subdirs = links
                    .map(link => link.getAttribute('href'))
                    .filter(href => !href.includes('.') && !href.startsWith('.') && href.endsWith('/'))
                    .map(href => href.slice(0, -1)); // Remove trailing slash
                
                let allCharacters = [];
                
                // Scan each subdirectory
                for (const subdir of subdirs) {
                    const subdirPath = `${basePath}/${subdir}`;
                    const characterImages = await scanDirectory(subdirPath);
                    allCharacters = allCharacters.concat(characterImages);
                }
                
                // Also scan the base directory for any direct images
                const baseImages = await scanDirectory(basePath);
                allCharacters = allCharacters.concat(baseImages);
                
                return allCharacters;
            } catch (error) {
                console.warn(`Could not scan character directories:`, error);
                return [];
            }
        }

        // Function to load assets with fallback data
        async function loadAssets() {
            const loadingMessage = document.getElementById('loadingMessage');
            
            try {
                loadingMessage.textContent = 'Scanning character folders...';
                characters = await scanCharacterDirectories('/Characters');
                
                loadingMessage.textContent = 'Scanning kart folders...';
                karts = await scanDirectory('/Karts');
                
                // If no assets found, use fallback data
                if (characters.length === 0) {
                    console.warn('No characters found, using fallback data');
                    characters = [
                        {picture: '/Characters/Mario/Mario.png', name: 'Mario'},
                        {picture: '/Characters/Mario/MarioAllTerrain.png', name: 'Mario All Terrain'},
                        {picture: '/Characters/Mario/MarioAviator.png', name: 'Mario Aviator'},
                    ];
                }
                
                if (karts.length === 0) {
                    console.warn('No karts found, using fallback data');
                    karts = [
                        {picture: '/Karts/StandardKart.png', name: 'Standard Kart'},
                        {picture: '/Karts/PipeFrame.png', name: 'Pipe Frame'},
                        {picture: '/Karts/Mach8.png', name: 'Mach 8'},
                    ];
                }
                
                loadingMessage.textContent = `Loaded ${characters.length} characters and ${karts.length} karts!`;
                
                // Enable buttons
                const generateBtn = document.getElementById('generateBtn');
                const addPlayerBtn = document.getElementById('addPlayerBtn');
                
                generateBtn.disabled = false;
                generateBtn.textContent = 'Generate';
                addPlayerBtn.disabled = false;
                
                // Update initial slots
                updateInitialSlots();
                
                assetsLoaded = true;
                
                setTimeout(() => {
                    loadingMessage.style.display = 'none';
                }, 2000);
                
            } catch (error) {
                console.error('Error loading assets:', error);
                loadingMessage.textContent = 'Error loading assets. Using fallback data.';
                loadingMessage.style.color = '#ff6b6b';
                
                // Use fallback data
                characters = [
                    {picture: '/Characters/Mario/Mario.png', name: 'Mario'},
                    {picture: '/Characters/Luigi/Luigi.png', name: 'Luigi'},
                    {picture: '/Characters/Peach/Peach.png', name: 'Peach'},
                ];
                karts = [
                    {picture: '/Karts/StandardKart.png', name: 'Standard Kart'},
                    {picture: '/Karts/PipeFrame.png', name: 'Pipe Frame'},
                    {picture: '/Karts/Mach8.png', name: 'Mach 8'},
                ];
                
                const generateBtn = document.getElementById('generateBtn');
                const addPlayerBtn = document.getElementById('addPlayerBtn');
                
                generateBtn.disabled = false;
                generateBtn.textContent = 'Generate';
                addPlayerBtn.disabled = false;
                
                updateInitialSlots();
                assetsLoaded = true;
            }
        }

        function updateInitialSlots() {
            const characterSlot = document.querySelector('#character-slot-0 .slot-item');
            const kartSlot = document.querySelector('#kart-slot-0 .slot-item');
            
            if (characters.length > 0) {
                characterSlot.innerHTML = `
                    <img src="${characters[0].picture}" alt="${characters[0].name}" class="slot-image">
                    <div class="slot-text">${characters[0].name}</div>
                `;
            }
            
            if (karts.length > 0) {
                kartSlot.innerHTML = `
                    <img src="${karts[0].picture}" alt="${karts[0].name}" class="slot-image">
                    <div class="slot-text">${karts[0].name}</div>
                `;
            }
        }

        function addPlayer() {
            if (players >= 4 || !assetsLoaded) return;
            
            players++;
            const playersContainer = document.getElementById('playersContainer');
            const playerIndex = players - 1;
            
            const playerDiv = document.createElement('div');
            playerDiv.className = 'player';
            playerDiv.innerHTML = `
                <div class="player-title">Player ${players}</div>
                <div class="combination">
                    <div class="slot-container">
                        <div class="slot" id="character-slot-${playerIndex}">
                            <div class="slot-item">
                                <img src="${characters[0].picture}" alt="${characters[0].name}" class="slot-image">
                                <div class="slot-text">${characters[0].name}</div>
                            </div>
                        </div>
                    </div>
                    <div class="plus-icon">+</div>
                    <div class="slot-container">
                        <div class="slot" id="kart-slot-${playerIndex}">
                            <div class="slot-item">
                                <img src="${karts[0].picture}" alt="${karts[0].name}" class="slot-image">
                                <div class="slot-text">${karts[0].name}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            playersContainer.appendChild(playerDiv);
            
            if (players >= 4) {
                document.getElementById('addPlayerBtn').disabled = true;
                document.getElementById('addPlayerBtn').textContent = 'Max Players Reached';
            }
        }

        function spinSlot(slotId, items, duration, finalItem) {
            const slot = document.getElementById(slotId);
            const slotItem = slot.querySelector('.slot-item');
            
            slot.classList.add('spinning');
            
            let spinCount = 0;
            const maxSpins = Math.floor(duration / 100);
            
            const spinInterval = setInterval(() => {
                const randomItem = items[Math.floor(Math.random() * items.length)];
                slotItem.innerHTML = `
                    <img src="${randomItem.picture}" alt="${randomItem.name}" class="slot-image">
                    <div class="slot-text">${randomItem.name}</div>
                `;
                spinCount++;
                
                if (spinCount >= maxSpins) {
                    clearInterval(spinInterval);
                    slot.classList.remove('spinning');
                    slotItem.innerHTML = `
                        <img src="${finalItem.picture}" alt="${finalItem.name}" class="slot-image">
                        <div class="slot-text">${finalItem.name}</div>
                    `;
                }
            }, 100);
        }

        function generateAll() {
            if (isGenerating || !assetsLoaded) return;
            
            isGenerating = true;
            const generateBtn = document.querySelector('.generate-btn');
            generateBtn.disabled = true;
            generateBtn.textContent = 'Generating...';
            
            for (let i = 0; i < players; i++) {
                const characterSlotId = `character-slot-${i}`;
                const kartSlotId = `kart-slot-${i}`;
                
                const finalCharacter = characters[Math.floor(Math.random() * characters.length)];
                const finalKart = karts[Math.floor(Math.random() * karts.length)];
                
                const duration = 2000 + Math.random() * 1000; // 2-3 seconds
                
                spinSlot(characterSlotId, characters, duration, finalCharacter);
                spinSlot(kartSlotId, karts, duration, finalKart);
            }
            
            setTimeout(() => {
                isGenerating = false;
                generateBtn.disabled = false;
                generateBtn.textContent = 'Generate';
            }, 3500);
        }

        // Load assets when page loads
        window.addEventListener('DOMContentLoaded', loadAssets);
    </script>
</body>
</html>